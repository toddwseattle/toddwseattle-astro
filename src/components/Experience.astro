---
import { getCollection } from 'astro:content';
import Container from './ui/Container';
import TitleSection from './ui/TitleSection';
import Timeline from './ui/Timeline.astro';

const experiences = await getCollection('experiences');
const sortedExperiences = experiences.sort((a, b) => {
  const dateA = new Date(a.data.startDate);
  const dateB = new Date(b.data.startDate);
  return dateB.getTime() - dateA.getTime();
});
---

<section class="bg-white py-12 md:py-16">
  <Container section client:load>
    <TitleSection 
      title="Experience" 
      subtitle="Professional work history"
      client:load
    />
    <div class="mt-8">
      {sortedExperiences.map(async (experience) => {
        const { Content } = await experience.render();
        return (
          <Timeline
            title={experience.data.company}
            subtitle={experience.data.position}
            startDate={experience.data.startDate}
            endDate={experience.data.endDate || 'Present'}
          >
            <Content />
          </Timeline>
        );
      })}
    </div>
  </Container>
</section>
